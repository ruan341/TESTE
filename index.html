<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Completo de Poltronas A350</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 20px;
            margin-bottom: 30px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #bb86fc;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Seat Map */
        .seat-map-section {
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .seat-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .seat {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .seat.available {
            background-color: #4caf50;
            color: white;
        }
        
        .seat.selected {
            background-color: #2196f3;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(33, 150, 243, 0.7);
        }
        
        .seat.occupied {
            background-color: #757575;
            color: white;
            cursor: not-allowed;
        }
        
        .seat.business {
            background-color: #ff9800;
            color: white;
        }
        
        /* Form Section */
        .form-section {
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #bb86fc;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #bb86fc;
            background-color: rgba(255, 255, 255, 0.15);
        }
        
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* Passenger Info */
        .passenger-info {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.2), rgba(33, 150, 243, 0.05));
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px solid #2196f3;
        }
        
        .passenger-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #bb86fc;
            text-align: center;
        }
        
        .passenger-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .detail-label {
            font-weight: bold;
            color: #bb86fc;
        }
        
        .detail-value {
            color: white;
        }
        
        .no-seat {
            color: #aaa;
            font-style: italic;
        }
        
        /* Buttons */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .btn {
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-confirm {
            background: linear-gradient(135deg, #4caf50, #3d8b40);
            color: white;
        }
        
        .btn-confirm:hover:not(:disabled) {
            background: linear-gradient(135deg, #3d8b40, #2e6b31);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }
        
        .btn-confirm:disabled {
            background: #757575;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }
        
        .btn-reset:hover {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(244, 67, 54, 0.3);
        }
        
        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 30px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .seat-grid {
                grid-template-columns: repeat(6, 1fr);
            }
            
            .seat {
                width: 40px;
                height: 40px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-plane"></i> Sistema de Poltronas A350</h1>
            <p class="subtitle">Preencha seus dados, escolha a poltrona e envie automaticamente</p>
            <div class="flight-info">
                <div class="info-item">
                    <i class="fas fa-plane-departure"></i> Voo: LA350 | GRU ‚Üí JFK
                </div>
                <div class="info-item">
                    <i class="fas fa-calendar-alt"></i> 15 Dez 2023 | 10:30h
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <!-- Seat Map -->
            <div class="seat-map-section">
                <h2 class="section-title">Selecione sua Poltrona</h2>
                <div class="seat-grid" id="seat-grid">
                    <!-- Seats will be generated by JavaScript -->
                </div>
                <div class="loading" id="loading-seats">
                    <i class="fas fa-spinner fa-spin"></i> Carregando poltronas...
                </div>
            </div>
            
            <!-- Passenger Form -->
            <div class="form-section">
                <h2 class="section-title">Seus Dados</h2>
                
                <!-- Passenger Info Display -->
                <div class="passenger-info" id="passenger-display">
                    <div class="passenger-title">Resumo da Reserva</div>
                    <div class="passenger-detail">
                        <span class="detail-label">Poltrona:</span>
                        <span class="detail-value" id="display-seat">
                            <span class="no-seat">N√£o selecionada</span>
                        </span>
                    </div>
                    <div class="passenger-detail">
                        <span class="detail-label">Nome:</span>
                        <span class="detail-value" id="display-name">-</span>
                    </div>
                    <div class="passenger-detail">
                        <span class="detail-label">Email:</span>
                        <span class="detail-value" id="display-email">-</span>
                    </div>
                    <div class="passenger-detail">
                        <span class="detail-label">CPF:</span>
                        <span class="detail-value" id="display-cpf">-</span>
                    </div>
                    <div class="passenger-detail">
                        <span class="detail-label">Telefone:</span>
                        <span class="detail-value" id="display-phone">-</span>
                    </div>
                </div>
                
                <!-- Input Form -->
                <div class="form-group">
                    <label class="form-label" for="name">
                        <i class="fas fa-user"></i> Nome Completo *
                    </label>
                    <input type="text" id="name" class="form-input" placeholder="Digite seu nome completo" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="email">
                        <i class="fas fa-envelope"></i> Email *
                    </label>
                    <input type="email" id="email" class="form-input" placeholder="seu@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="cpf">
                        <i class="fas fa-id-card"></i> CPF *
                    </label>
                    <input type="text" id="cpf" class="form-input" placeholder="000.000.000-00" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="phone">
                        <i class="fas fa-phone"></i> Telefone *
                    </label>
                    <input type="tel" id="phone" class="form-input" placeholder="(11) 99999-9999" required>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-confirm" id="confirm-btn" disabled>
                        <i class="fas fa-paper-plane"></i> Gerar Formul√°rio Completo
                    </button>
                    
                    <button class="btn btn-reset" id="reset-btn">
                        <i class="fas fa-redo"></i> Limpar Tudo
                    </button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Sistema Autom√°tico de Reservas A350 | Google Forms + Google Sheets + Email Autom√°tico</p>
            <p>Dados pr√©-preenchidos automaticamente no formul√°rio</p>
        </footer>
    </div>

    <script>
        // ============================================
        // CONFIGURA√á√ÉO DO SISTEMA
        // ============================================
        
        // LINK BASE DO GOOGLE FORMS
        const FORM_BASE_URL = "https://docs.google.com/forms/d/e/1FAIpQLSf0wYXE6i7JPQCBkKR5LqyRdwxRscpSmclDMQJXTs_llonIbA/viewform";
        
        // IDs DOS CAMPOS DO FORMUL√ÅRIO (PRECISA CONFIRMAR ESSES IDs!)
        // Substitua pelos IDs reais dos seus campos no Google Forms
        const FIELD_IDS = {
            SEAT: "entry.1796450485",      // Poltrona (j√° sabemos que √© esse)
            NAME: "entry.1234567890",      // Nome - SUBSTITUIR PELO ID REAL
            EMAIL: "entry.0987654321",     // Email - SUBSTITUIR PELO ID REAL
            CPF: "entry.1122334455",       // CPF - SUBSTITUIR PELO ID REAL
            PHONE: "entry.5566778899"      // Telefone - SUBSTITUIR PELO ID REAL
        };
        
        // API para verificar poltronas ocupadas
        const API_URL = "https://script.google.com/macros/s/AKfycbyi3dJoWMIJBY_YUuGlsKHJQ2lnPamVXsVOYOoQK_NEso0dbbmjP_S5DBuI9fRcSwOnLw/exec";
        
        // ============================================
        // VARI√ÅVEIS DO SISTEMA
        // ============================================
        let selectedSeat = null;
        let occupiedSeats = [];
        let passengerData = {
            name: "",
            email: "",
            cpf: "",
            phone: ""
        };
        
        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            initializeSeatMap();
            loadOccupiedSeats();
            setupEventListeners();
            setupFormValidation();
        });
        
        // ============================================
        // INICIALIZA MAPA DE POLTRONAS
        // ============================================
        function initializeSeatMap() {
            const seatGrid = document.getElementById('seat-grid');
            seatGrid.innerHTML = '';
            
            // Layout A350 - 40 linhas, 9 assentos por fila (A-K)
            for (let row = 1; row <= 40; row++) {
                // Economy Class (linhas 13-40)
                if (row >= 13) {
                    // Layout 3-3-3
                    for (let col = 0; col < 9; col++) {
                        if (col === 3) {
                            // Corredor
                            const aisle = document.createElement('div');
                            aisle.className = 'aisle';
                            if (row === 13) aisle.textContent = 'Corredor';
                            seatGrid.appendChild(aisle);
                            continue;
                        }
                        
                        const seatLetter = getSeatLetterEconomy(col);
                        const seatId = `${row}${seatLetter}`;
                        createSeatElement(seatId, 'available');
                    }
                }
                // Premium Economy (linhas 7-12)
                else if (row >= 7) {
                    // Layout 2-4-2
                    for (let col = 0; col < 9; col++) {
                        if (col === 3) {
                            // Corredor
                            const aisle = document.createElement('div');
                            aisle.className = 'aisle';
                            if (row === 7) aisle.textContent = 'Corredor';
                            seatGrid.appendChild(aisle);
                            continue;
                        }
                        
                        const seatLetter = getSeatLetterPremium(col);
                        const seatId = `${row}${seatLetter}`;
                        createSeatElement(seatId, 'available');
                    }
                }
                // Business Class (linhas 1-6)
                else {
                    // Layout 1-2-1
                    for (let col = 0; col < 9; col++) {
                        if (col < 1 || col > 7) continue;
                        if (col === 3 || col === 4) continue;
                        
                        const seatLetter = getSeatLetterBusiness(col);
                        const seatId = `${row}${seatLetter}`;
                        createSeatElement(seatId, 'business');
                    }
                    
                    // Espa√ßadores
                    for (let i = 0; i < 2; i++) {
                        seatGrid.appendChild(document.createElement('div'));
                    }
                }
            }
        }
        
        // ============================================
        // FUN√á√ïES AUXILIARES PARA LETRAS DAS POLTRONAS
        // ============================================
        function getSeatLetterBusiness(col) {
            const letters = ['A', 'D', 'E', 'H'];
            return letters[col - 1];
        }
        
        function getSeatLetterPremium(col) {
            const letters = ['A', 'B', 'D', 'E', 'F', 'G', 'J', 'K'];
            const index = col < 3 ? col : col - 1;
            return letters[index];
        }
        
        function getSeatLetterEconomy(col) {
            const letters = ['A', 'B', 'C', 'E', 'F', 'G', 'H', 'J', 'K'];
            const index = col < 3 ? col : col - 1;
            return letters[index];
        }
        
        // ============================================
        // CRIA ELEMENTO DE POLTRONA
        // ============================================
        function createSeatElement(seatId, seatType) {
            const seatGrid = document.getElementById('seat-grid');
            
            const seatElement = document.createElement('div');
            seatElement.className = `seat ${seatType}`;
            seatElement.dataset.seatId = seatId;
            seatElement.textContent = seatId;
            
            seatElement.addEventListener('click', function() {
                selectSeat(seatId);
            });
            
            seatGrid.appendChild(seatElement);
            return seatElement;
        }
        
        // ============================================
        // CARREGA POLTRONAS OCUPADAS
        // ============================================
        function loadOccupiedSeats() {
            fetch(API_URL + '?t=' + new Date().getTime())
                .then(response => response.json())
                .then(data => {
                    occupiedSeats = Array.isArray(data) ? data : [];
                    updateSeatStatus();
                    document.getElementById('loading-seats').style.display = 'none';
                })
                .catch(error => {
                    console.log('Usando dados de demonstra√ß√£o');
                    occupiedSeats = ["1A", "2D", "5H", "7B", "9G", "12A", "15C", "18F", "22B"];
                    updateSeatStatus();
                    document.getElementById('loading-seats').style.display = 'none';
                });
        }
        
        // ============================================
        // ATUALIZA STATUS DAS POLTRONAS
        // ============================================
        function updateSeatStatus() {
            document.querySelectorAll('.seat').forEach(seat => {
                const seatId = seat.dataset.seatId;
                
                if (occupiedSeats.includes(seatId)) {
                    seat.classList.remove('available', 'business', 'selected');
                    seat.classList.add('occupied');
                    
                    if (selectedSeat === seatId) {
                        selectedSeat = null;
                        updatePassengerDisplay();
                        checkFormCompletion();
                    }
                }
            });
        }
        
        // ============================================
        // SELECIONA POLTRONA
        // ============================================
        function selectSeat(seatId) {
            if (occupiedSeats.includes(seatId)) {
                alert(`A poltrona ${seatId} j√° est√° ocupada. Escolha outra.`);
                return;
            }
            
            // Remove sele√ß√£o anterior
            if (selectedSeat) {
                const prevSeat = document.querySelector(`.seat[data-seat-id="${selectedSeat}"]`);
                if (prevSeat && !occupiedSeats.includes(selectedSeat)) {
                    prevSeat.classList.remove('selected');
                    prevSeat.classList.add(prevSeat.classList.contains('business') ? 'business' : 'available');
                }
            }
            
            // Seleciona nova poltrona
            selectedSeat = seatId;
            const newSeat = document.querySelector(`.seat[data-seat-id="${seatId}"]`);
            
            if (newSeat) {
                newSeat.classList.remove('available', 'business');
                newSeat.classList.add('selected');
            }
            
            updatePassengerDisplay();
            checkFormCompletion();
        }
        
        // ============================================
        // ATUALIZA DISPLAY DO PASSAGEIRO
        // ============================================
        function updatePassengerDisplay() {
            // Atualiza poltrona
            const seatDisplay = document.getElementById('display-seat');
            if (selectedSeat) {
                seatDisplay.innerHTML = `<strong style="color: #2196f3;">${selectedSeat}</strong>`;
            } else {
                seatDisplay.innerHTML = '<span class="no-seat">N√£o selecionada</span>';
            }
            
            // Atualiza dados do formul√°rio
            passengerData.name = document.getElementById('name').value;
            passengerData.email = document.getElementById('email').value;
            passengerData.cpf = document.getElementById('cpf').value;
            passengerData.phone = document.getElementById('phone').value;
            
            document.getElementById('display-name').textContent = passengerData.name || "-";
            document.getElementById('display-email').textContent = passengerData.email || "-";
            document.getElementById('display-cpf').textContent = passengerData.cpf || "-";
            document.getElementById('display-phone').textContent = passengerData.phone || "-";
        }
        
        // ============================================
        // CONFIGURA VALIDA√á√ÉO DO FORMUL√ÅRIO
        // ============================================
        function setupFormValidation() {
            const inputs = ['name', 'email', 'cpf', 'phone'];
            
            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                input.addEventListener('input', function() {
                    updatePassengerDisplay();
                    checkFormCompletion();
                });
            });
        }
        
        // ============================================
        // VERIFICA SE FORMUL√ÅRIO EST√Å COMPLETO
        // ============================================
        function checkFormCompletion() {
            const isFormValid = 
                passengerData.name.trim() !== "" &&
                passengerData.email.trim() !== "" &&
                passengerData.cpf.trim() !== "" &&
                passengerData.phone.trim() !== "" &&
                selectedSeat !== null;
            
            const confirmBtn = document.getElementById('confirm-btn');
            confirmBtn.disabled = !isFormValid;
        }
        
        // ============================================
        // CONFIGURA EVENT LISTENERS
        // ============================================
        function setupEventListeners() {
            // Bot√£o de confirma√ß√£o
            document.getElementById('confirm-btn').addEventListener('click', function() {
                generateAndOpenForm();
            });
            
            // Bot√£o de reset
            document.getElementById('reset-btn').addEventListener('click', function() {
                resetEverything();
            });
        }
        
        // ============================================
        // GERA E ABRE FORMUL√ÅRIO PR√â-PREENCHIDO
        // ============================================
        function generateAndOpenForm() {
            // Verifica se a poltrona ainda est√° dispon√≠vel
            if (occupiedSeats.includes(selectedSeat)) {
                alert(`A poltrona ${selectedSeat} acabou de ser ocupada. Por favor, escolha outra.`);
                loadOccupiedSeats();
                return;
            }
            
            // Monta URL com todos os campos pr√©-preenchidos
            let formUrl = FORM_BASE_URL + "?usp=pp_url";
            
            // ADICIONE OS PAR√ÇMETROS COM OS IDs CORRETOS
            formUrl += `&${FIELD_IDS.SEAT}=${encodeURIComponent(selectedSeat)}`;
            formUrl += `&${FIELD_IDS.NAME}=${encodeURIComponent(passengerData.name)}`;
            formUrl += `&${FIELD_IDS.EMAIL}=${encodeURIComponent(passengerData.email)}`;
            formUrl += `&${FIELD_IDS.CPF}=${encodeURIComponent(passengerData.cpf)}`;
            formUrl += `&${FIELD_IDS.PHONE}=${encodeURIComponent(passengerData.phone)}`;
            
            console.log("URL gerada:", formUrl);
            
            // Abre o formul√°rio em nova aba
            const formWindow = window.open(formUrl, '_blank');
            
            if (formWindow) {
                alert("‚úÖ Formul√°rio gerado com sucesso!\n\nTODOS os campos j√° est√£o preenchidos.\n\nBasta clicar em 'ENVIAR' no Google Forms.\n\nAp√≥s enviar, voc√™ receber√° um email com seu c√≥digo de check-in.");
                
                // Monitora se o formul√°rio foi fechado
                const checkClosed = setInterval(() => {
                    if (formWindow.closed) {
                        clearInterval(checkClosed);
                        
                        // Pergunta se enviou o formul√°rio
                        const didSubmit = confirm("Voc√™ j√° enviou o formul√°rio?\n\nSe SIM, sua poltrona ser√° bloqueada.\nSe N√ÉO, ainda pode editar.");
                        
                        if (didSubmit) {
                            // Atualiza lista de poltronas ocupadas
                            setTimeout(() => {
                                loadOccupiedSeats();
                                alert("üéâ Formul√°rio enviado com sucesso!\n\nVerifique seu email para o c√≥digo de check-in.");
                            }, 2000);
                        }
                    }
                }, 1000);
            }
        }
        
        // ============================================
        // RESETA TUDO
        // ============================================
        function resetEverything() {
            // Limpa sele√ß√£o de poltrona
            if (selectedSeat) {
                const seatElement = document.querySelector(`.seat[data-seat-id="${selectedSeat}"]`);
                if (seatElement && !occupiedSeats.includes(selectedSeat)) {
                    seatElement.classList.remove('selected');
                    seatElement.classList.add(seatElement.classList.contains('business') ? 'business' : 'available');
                }
                selectedSeat = null;
            }
            
            // Limpa campos do formul√°rio
            document.getElementById('name').value = '';
            document.getElementById('email').value = '';
            document.getElementById('cpf').value = '';
            document.getElementById('phone').value = '';
            
            // Limpa dados
            passengerData = { name: "", email: "", cpf: "", phone: "" };
            
            // Atualiza display
            updatePassengerDisplay();
            checkFormCompletion();
            
            alert("Formul√°rio limpo. Pode come√ßar uma nova reserva.");
        }
        
        // ============================================
        // FUN√á√ïES DE TESTE
        // ============================================
        window.testFormURL = function() {
            if (!selectedSeat) {
                alert("Selecione uma poltrona primeiro");
                return;
            }
            
            // Teste com dados de exemplo
            const testData = {
                seat: selectedSeat,
                name: "Jo√£o Silva Teste",
                email: "teste@exemplo.com",
                cpf: "123.456.789-00",
                phone: "(11) 99999-9999"
            };
            
            let testUrl = FORM_BASE_URL + "?usp=pp_url";
            testUrl += `&${FIELD_IDS.SEAT}=${encodeURIComponent(testData.seat)}`;
            testUrl += `&${FIELD_IDS.NAME}=${encodeURIComponent(testData.name)}`;
            testUrl += `&${FIELD_IDS.EMAIL}=${encodeURIComponent(testData.email)}`;
            testUrl += `&${FIELD_IDS.CPF}=${encodeURIComponent(testData.cpf)}`;
            testUrl += `&${FIELD_IDS.PHONE}=${encodeURIComponent(testData.phone)}`;
            
            console.log("URL de teste:", testUrl);
            window.open(testUrl, '_blank');
        };
    </script>
</body>
</html>
